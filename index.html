<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ - Ø¨Ø« ØµÙˆØªÙŠ Ù…Ø¨Ø§Ø´Ø±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&amp;display=swap" rel="stylesheet">
  <style>
    body { 
      box-sizing: border-box; 
      font-family: 'Tajawal', sans-serif;
    }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .live-pulse { animation: pulse 1.5s infinite; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-emerald-900 via-emerald-800 to-teal-900">
  <div class="w-full h-full flex flex-col">
   <header class="bg-emerald-950/80 py-8 text-center border-b border-emerald-700/50">
    <h1 class="text-4xl font-bold text-white mb-2">Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡</h1>
    <p class="text-emerald-200">Ø¨Ø« ØµÙˆØªÙŠ Ù…Ø¨Ø§Ø´Ø±</p>
   </header>
   <main class="flex-1 max-w-2xl mx-auto px-4 py-8 w-full"><!-- Ø§Ù„Ø¨Ø« Ø§Ù„Ø­Ø§Ù„ÙŠ -->
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 mb-6 border border-emerald-600/30">
     <div id="status-display" class="text-center">
      <p class="text-emerald-200 text-xl mb-4">â³ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
     </div>
     <div id="broadcast-active" class="hidden text-center">
      <div class="mb-6">
       <h2 id="title" class="text-2xl font-bold text-white mb-2"></h2>
       <p id="speaker" class="text-amber-400 text-lg mb-6"></p>
       <div id="live-badge" class="hidden inline-flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-full"><span class="w-2 h-2 bg-white rounded-full live-pulse"></span> <span>ğŸ”´ Ù…Ø¨Ø§Ø´Ø±</span>
       </div>
      </div><button id="listen-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold px-8 py-3 rounded-full"> ğŸ§ Ø§Ø³ØªÙ…Ø¹ Ø§Ù„Ø¢Ù† </button> <button id="stop-btn" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold px-8 py-3 rounded-full"> â¹ï¸ ØªÙˆÙ‚Ù </button>
      <p id="listeners" class="text-emerald-200 mt-4">0 Ù…Ø³ØªÙ…Ø¹</p>
     </div>
     <div id="no-broadcast" class="text-center py-8">
      <p class="text-emerald-300 text-lg">ğŸ™ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø« Ø­Ø§Ù„ÙŠØ§Ù‹</p>
     </div>
    </div><!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="bg-amber-500/10 backdrop-blur-md rounded-2xl p-8 border border-amber-500/30">
     <h3 class="text-xl font-bold text-amber-400 mb-4">âš™ï¸ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¨Ø«</h3>
     <div id="login-form"><input type="password" id="pwd" class="w-full bg-emerald-900/50 border border-emerald-600 rounded-lg px-4 py-2 text-white mb-3 focus:outline-none" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±"> <button id="login-btn" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 rounded-lg">Ø¯Ø®ÙˆÙ„</button>
     </div>
     <div id="control-panel" class="hidden"><input type="text" id="title-input" class="w-full bg-emerald-900/50 border border-emerald-600 rounded-lg px-4 py-2 text-white mb-3 focus:outline-none" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙ„Ù…Ø©"> <input type="text" id="speaker-input" class="w-full bg-emerald-900/50 border border-emerald-600 rounded-lg px-4 py-2 text-white mb-3 focus:outline-none" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù‚ÙŠ">
      <div class="flex gap-2 mb-3"><input type="text" id="share-url" readonly class="flex-1 bg-emerald-800/50 border border-emerald-600 rounded-lg px-4 py-2 text-emerald-300 text-sm"> <button id="copy-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold px-4 py-2 rounded-lg">ğŸ“‹</button>
      </div><button id="start-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded-lg mb-2">â–¶ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø«</button> <button id="stop-broadcast-btn" class="hidden w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-lg">â¹ï¸ Ø£ÙˆÙ‚Ù Ø§Ù„Ø¨Ø«</button>
     </div>
    </div>
   </main>
  </div>
  <script>
    const PASSWORD = "1234";
    let isBroadcasting = false;
    let isListening = false;
    let listeners = 0;
    let audioContext = null;
    let mediaStream = null;

    // Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
    document.getElementById('login-btn').addEventListener('click', () => {
      if (document.getElementById('pwd').value === PASSWORD) {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('control-panel').classList.remove('hidden');
        updateShareUrl();
      } else {
        alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©');
      }
    });

    // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
    function updateShareUrl() {
      const url = new URL(window.location);
      document.getElementById('share-url').value = url.toString();
    }

    // Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
    document.getElementById('copy-btn').addEventListener('click', () => {
      document.getElementById('share-url').select();
      document.execCommand('copy');
      document.getElementById('copy-btn').textContent = 'âœ…';
      setTimeout(() => { document.getElementById('copy-btn').textContent = 'ğŸ“‹'; }, 2000);
    });

    // Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø«
    document.getElementById('start-btn').addEventListener('click', async () => {
      const title = document.getElementById('title-input').value.trim();
      const speaker = document.getElementById('speaker-input').value.trim();

      if (!title || !speaker) {
        alert('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        return;
      }

      try {
        mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        audioContext = new (window.AudioContext || window.webkitAudioContext)();

        isBroadcasting = true;
        listeners = 0;

        document.getElementById('title').textContent = title;
        document.getElementById('speaker').textContent = speaker;
        document.getElementById('no-broadcast').classList.add('hidden');
        document.getElementById('broadcast-active').classList.remove('hidden');
        document.getElementById('live-badge').classList.remove('hidden');

        document.getElementById('start-btn').classList.add('hidden');
        document.getElementById('stop-broadcast-btn').classList.remove('hidden');

        startAudioProcessing();
      } catch (error) {
        alert('Ø®Ø·Ø£: ' + error.message);
      }
    });

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØª
    function startAudioProcessing() {
      const source = audioContext.createMediaStreamSource(mediaStream);
      const processor = audioContext.createScriptProcessor(4096, 1, 1);

      source.connect(processor);
      processor.connect(audioContext.destination);

      processor.onaudioprocess = (e) => {
        if (isListening) {
          const audioData = e.inputBuffer.getChannelData(0);
          playAudio(new Float32Array(audioData));
        }
      };
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
    function playAudio(data) {
      try {
        const buffer = audioContext.createBuffer(1, data.length, audioContext.sampleRate);
        buffer.getChannelData(0).set(data);
        
        const source = audioContext.createBufferSource();
        source.buffer = buffer;
        source.connect(audioContext.destination);
        source.start(0);
      } catch (e) {}
    }

    // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ø¨Ø«
    document.getElementById('listen-btn').addEventListener('click', () => {
      isListening = true;
      listeners++;

      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }

      document.getElementById('listen-btn').classList.add('hidden');
      document.getElementById('stop-btn').classList.remove('hidden');
      document.getElementById('listeners').textContent = listeners + ' Ù…Ø³ØªÙ…Ø¹';
    });

    // ØªÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹
    document.getElementById('stop-btn').addEventListener('click', () => {
      isListening = false;
      listeners = Math.max(0, listeners - 1);
      
      document.getElementById('listen-btn').classList.remove('hidden');
      document.getElementById('stop-btn').classList.add('hidden');
      document.getElementById('listeners').textContent = listeners + ' Ù…Ø³ØªÙ…Ø¹';
    });

    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«
    document.getElementById('stop-broadcast-btn').addEventListener('click', () => {
      if (mediaStream) {
        mediaStream.getTracks().forEach(t => t.stop());
      }
      if (audioContext) {
        audioContext.close();
      }

      isBroadcasting = false;
      listeners = 0;

      document.getElementById('broadcast-active').classList.add('hidden');
      document.getElementById('no-broadcast').classList.remove('hidden');
      document.getElementById('start-btn').classList.remove('hidden');
      document.getElementById('stop-broadcast-btn').classList.add('hidden');
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cad1ebf97c62cff',t:'MTc3MDU3NDYwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>